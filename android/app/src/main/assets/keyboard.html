<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,viewport-fit=cover">
    <meta name="theme-color" content="#1a1a2e">
    <title>Fast Keyboard</title>
    <style>
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           RESET & BASE - à¶¸à·–à¶½à·’à¶š styles
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            touch-action: none;
            overscroll-behavior: none;
            background: linear-gradient(180deg, #1a1a2e 0%, #16162a 100%);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 
                         'Helvetica Neue', Arial, sans-serif;
            -webkit-font-smoothing: antialiased;
        }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           KEYBOARD CONTAINER
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        #keyboard {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
            padding: 6px 4px 10px 4px;
            gap: 6px;
        }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           KEYBOARD ROWS - CSS Grid Layout
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .row {
            display: grid;
            gap: 4px;
            width: 100%;
            flex: 1;
            min-height: 0;
        }
        
        /* Row 1: Q-P (10 keys) */
        .row:nth-child(1) { grid-template-columns: repeat(10, 1fr); }
        
        /* Row 2: A-L (9 keys with padding) */
        .row:nth-child(2) { 
            grid-template-columns: repeat(9, 1fr);
            padding: 0 5%;
        }
        
        /* Row 3: Shift + Z-M + Backspace */
        .row:nth-child(3) { grid-template-columns: 1.4fr repeat(7, 1fr) 1.4fr; }
        
        /* Row 4: Symbols, Comma, Space, Period, Enter */
        .row:nth-child(4) { grid-template-columns: 1.3fr 1fr 4fr 1fr 1.3fr; }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           KEY BUTTONS - à¶´à·Šâ€à¶»à¶°à·à¶± key styling
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .key {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 44px;
            background: linear-gradient(180deg, #3d3d5c 0%, #2d2d4a 100%);
            border: none;
            border-radius: 5px;
            box-shadow: 0 1px 0 0 rgba(0,0,0,0.3),
                       0 1px 3px rgba(0,0,0,0.2),
                       inset 0 1px 0 rgba(255,255,255,0.07);
            color: #ffffff;
            font-size: 21px;
            font-weight: 500;
            line-height: 1;
            cursor: pointer;
            transition: transform 50ms ease-out, background 50ms ease-out;
            contain: content;
            will-change: transform;
        }
        
        /* Active/Pressed State */
        .key.active {
            background: linear-gradient(180deg, #5a5a8c 0%, #4a4a7a 100%);
            transform: scale(0.92);
        }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           SPECIAL KEYS - à·€à·’à·à·šà·‚ keys
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .key.special {
            background: linear-gradient(180deg, #28284a 0%, #1e1e3a 100%);
            font-size: 12px;
            font-weight: 700;
            color: #9090b0;
            letter-spacing: 0.5px;
        }
        
        .key.special.active {
            background: linear-gradient(180deg, #404068 0%, #303050 100%);
        }
        
        /* Shift Key - Active/Caps Lock */
        .key.shift.shifted {
            background: linear-gradient(180deg, #4080a0 0%, #306080 100%);
            color: #00e5ff;
        }
        
        /* Space Bar */
        .key.space {
            background: linear-gradient(180deg, #404065 0%, #303050 100%);
            font-size: 11px;
            letter-spacing: 3px;
            color: #8080a0;
        }
        
        /* Enter Key */
        .key.enter {
            background: linear-gradient(180deg, #2060a0 0%, #185080 100%);
            color: #40c4ff;
        }
        
        .key.enter.active {
            background: linear-gradient(180deg, #3080c0 0%, #2070a0 100%);
        }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           SVG ICONS
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .key svg {
            width: 22px;
            height: 22px;
            fill: currentColor;
            pointer-events: none;
        }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           KEY POPUP PREVIEW
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        #popup {
            position: fixed;
            display: none;
            align-items: center;
            justify-content: center;
            width: 52px;
            height: 66px;
            background: linear-gradient(180deg, #6060a0 0%, #505090 100%);
            border-radius: 8px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.4);
            color: #ffffff;
            font-size: 36px;
            font-weight: 600;
            pointer-events: none;
            z-index: 9999;
            transform: translateX(-50%);
        }
        
        #popup.visible {
            display: flex;
            animation: popUp 80ms ease-out;
        }
        
        @keyframes popUp {
            from { opacity: 0; transform: translateX(-50%) scale(0.7); }
            to { opacity: 1; transform: translateX(-50%) scale(1); }
        }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           DEBUG STATUS BAR (production à¶‘à¶šà·šà¶¯à·“ hide à¶šà¶»à¶±à·Šà¶±)
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        #debug {
            display: none; /* 'flex' à¶šà¶»à¶±à·Šà¶± debugging à·€à¶½à¶§ */
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 2px 8px;
            background: rgba(0,0,0,0.8);
            color: #0f0;
            font-size: 9px;
            font-family: monospace;
            z-index: 10000;
        }
    </style>
</head>
<body>
    <!-- Debug Bar -->
    <div id="debug">Initializing...</div>
    
    <!-- Keyboard Container -->
    <div id="keyboard"></div>
    
    <!-- Key Popup Preview -->
    <div id="popup"></div>

<script>
(function() {
    'use strict';

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CONFIGURATION - à·€à·’à¶±à·Šâ€à¶ºà·à·ƒà¶º
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    var CONFIG = {
        VIBRATE_MS: 3,          // Haptic feedback à¶šà·à¶½à¶º (ms)
        HOLD_DELAY: 400,        // Long press threshold (ms)
        REPEAT_INTERVAL: 50,    // Key repeat interval (ms)
        DBL_TAP_MS: 280         // Double-tap for caps lock (ms)
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // MOCK BRIDGE - Browser Testing à·ƒà¶³à·„à·
    // Android Bridge à¶±à·à¶­à·’à¶±à¶¸à·Š console.log à¶·à·à·€à·’à¶­à· à¶šà¶»à¶±à·€à·
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    var Bridge = {
        isAndroid: typeof window.AndroidBridge !== 'undefined',
        
        commitText: function(text) {
            if (this.isAndroid) {
                window.AndroidBridge.commitText(text);
            } else {
                console.log('ğŸ“ commitText:', text);
                debug('Typed: ' + text);
            }
        },
        
        deleteText: function(count) {
            if (this.isAndroid) {
                window.AndroidBridge.deleteText(count);
            } else {
                console.log('âŒ« deleteText:', count);
                debug('Delete: ' + count);
            }
        },
        
        performAction: function() {
            if (this.isAndroid) {
                window.AndroidBridge.performEditorAction();
            } else {
                console.log('â†µ performAction');
                debug('Enter pressed');
            }
        },
        
        vibrate: function(ms) {
            if (this.isAndroid) {
                window.AndroidBridge.vibrate(ms);
            } else if (navigator.vibrate) {
                navigator.vibrate(ms);
            }
        },
        
        hideKeyboard: function() {
            if (this.isAndroid) {
                window.AndroidBridge.hideKeyboard();
            } else {
                console.log('âŒ¨ï¸ hideKeyboard');
            }
        },
        
        log: function(msg) {
            if (this.isAndroid) {
                window.AndroidBridge.log(msg);
            }
            console.log('[KB]', msg);
        }
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // STATE - à¶šà·“à¶¶à·à¶©à·Š à¶­à¶­à·Šà·€à¶º
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    var state = {
        shift: false,       // Shift key active à¶¯
        caps: false,        // Caps lock on à¶¯
        mode: 'letters',    // 'letters', 'numbers', 'symbols'
        lastShiftTime: 0    // Double-tap detection à·ƒà¶³à·„à·
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // KEYBOARD LAYOUTS - à¶šà·“à¶¶à·à¶©à·Š layouts
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    var layouts = {
        letters: [
            ['q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p'],
            ['a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l'],
            ['SHIFT', 'z', 'x', 'c', 'v', 'b', 'n', 'm', 'BACKSPACE'],
            ['123', ',', 'SPACE', '.', 'ENTER']
        ],
        numbers: [
            ['1', '2', '3', '4', '5', '6', '7', '8', '9', '0'],
            ['@', '#', '$', '%', '&', '-', '+', '(', ')'],
            ['#+=', '*', '"', "'", ':', ';', '!', '?', 'BACKSPACE'],
            ['ABC', ',', 'SPACE', '.', 'ENTER']
        ],
        symbols: [
            ['~', '`', '|', 'â€¢', 'âˆš', 'Ï€', 'Ã·', 'Ã—', 'Â¶', 'âˆ†'],
            ['Â£', 'â‚¬', 'Â¥', '^', 'Â°', '=', '{', '}', '\\'],
            ['123', 'Â©', 'Â®', 'â„¢', 'âœ“', '[', ']', '<', 'BACKSPACE'],
            ['ABC', ',', 'SPACE', '.', 'ENTER']
        ]
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SVG ICONS - Key icons
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    var icons = {
        SHIFT: '<svg viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>',
        BACKSPACE: '<svg viewBox="0 0 24 24"><path d="M22 3H7c-.69 0-1.23.35-1.59.88L0 12l5.41 8.11c.36.53.9.89 1.59.89h15c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-3 12.59L17.59 17 14 13.41 10.41 17 9 15.59 12.59 12 9 8.41 10.41 7 14 10.59 17.59 7 19 8.41 15.41 12 19 15.59z"/></svg>',
        ENTER: '<svg viewBox="0 0 24 24"><path d="M19 7v4H5.83l3.58-3.59L8 6l-6 6 6 6 1.41-1.41L5.83 13H21V7z"/></svg>'
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // DOM ELEMENTS CACHE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    var elements = {
        keyboard: null,
        popup: null,
        debugEl: null
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // TOUCH STATE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    var touch = {
        activeKey: null,
        holdTimer: null,
        repeatTimer: null
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // DEBUG HELPER
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function debug(msg) {
        if (elements.debugEl) {
            elements.debugEl.textContent = msg;
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RENDERING - UI Rendering
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function render() {
        if (!elements.keyboard) return;
        
        var layout = layouts[state.mode];
        var html = '';
        
        layout.forEach(function(row) {
            html += '<div class="row">';
            row.forEach(function(key) {
                html += createKeyHTML(key);
            });
            html += '</div>';
        });
        
        elements.keyboard.innerHTML = html;
        Bridge.log('Keyboard rendered: ' + state.mode);
    }
    
    function createKeyHTML(key) {
        var classes = ['key'];
        var content = '';
        var dataKey = key;
        
        switch (key) {
            case 'SHIFT':
                classes.push('special', 'shift');
                if (state.shift || state.caps) classes.push('shifted');
                content = icons.SHIFT;
                break;
                
            case 'BACKSPACE':
                classes.push('special');
                content = icons.BACKSPACE;
                break;
                
            case 'ENTER':
                classes.push('special', 'enter');
                content = icons.ENTER;
                break;
                
            case 'SPACE':
                classes.push('space');
                content = 'space';
                break;
                
            case '123':
            case '#+=':
            case 'ABC':
                classes.push('special');
                content = key;
                break;
                
            default:
                // Regular character
                var displayChar = key;
                if ((state.shift || state.caps) && /^[a-z]$/.test(key)) {
                    displayChar = key.toUpperCase();
                }
                content = displayChar;
        }
        
        return '<div class="' + classes.join(' ') + '" data-key="' + dataKey + '">' + 
               content + '</div>';
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // KEY PRESS HANDLING - Key press handling
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function handleKeyPress(key) {
        Bridge.vibrate(CONFIG.VIBRATE_MS);
        
        switch (key) {
            case 'SHIFT':
                handleShift();
                break;
                
            case 'BACKSPACE':
                Bridge.deleteText(1);
                break;
                
            case 'ENTER':
                Bridge.performAction();
                break;
                
            case 'SPACE':
                Bridge.commitText(' ');
                autoUnshift();
                break;
                
            case '123':
                state.mode = 'numbers';
                render();
                break;
                
            case '#+=':
                state.mode = 'symbols';
                render();
                break;
                
            case 'ABC':
                state.mode = 'letters';
                render();
                break;
                
            default:
                // Regular character
                var char = key;
                if ((state.shift || state.caps) && /^[a-z]$/.test(key)) {
                    char = key.toUpperCase();
                }
                Bridge.commitText(char);
                autoUnshift();
        }
    }
    
    function handleShift() {
        var now = Date.now();
        
        if (now - state.lastShiftTime < CONFIG.DBL_TAP_MS) {
            // Double-tap = Caps lock toggle
            state.caps = !state.caps;
            state.shift = state.caps;
            Bridge.log('Caps lock: ' + (state.caps ? 'ON' : 'OFF'));
        } else {
            // Single tap
            if (state.caps) {
                state.caps = false;
                state.shift = false;
            } else {
                state.shift = !state.shift;
            }
        }
        
        state.lastShiftTime = now;
        updateShiftKeys();
    }
    
    function autoUnshift() {
        if (state.shift && !state.caps) {
            state.shift = false;
            updateShiftKeys();
        }
    }
    
    function updateShiftKeys() {
        // Update all letter keys
        var keys = elements.keyboard.querySelectorAll('.key');
        keys.forEach(function(keyEl) {
            var key = keyEl.getAttribute('data-key');
            
            if (/^[a-z]$/.test(key)) {
                keyEl.textContent = (state.shift || state.caps) ? 
                                    key.toUpperCase() : key;
            }
            
            if (key === 'SHIFT') {
                if (state.shift || state.caps) {
                    keyEl.classList.add('shifted');
                } else {
                    keyEl.classList.remove('shifted');
                }
            }
        });
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // POPUP PREVIEW - Key popup
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function showPopup(keyEl, char) {
        if (!elements.popup || !keyEl) return;
        if (char.length !== 1) return; // Only for single characters
        
        var rect = keyEl.getBoundingClientRect();
        elements.popup.textContent = char;
        elements.popup.style.left = (rect.left + rect.width / 2) + 'px';
        elements.popup.style.top = (rect.top - 10) + 'px';
        elements.popup.classList.add('visible');
    }
    
    function hidePopup() {
        if (elements.popup) {
            elements.popup.classList.remove('visible');
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // EVENT HANDLING - Touch/Mouse events
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function onPointerDown(e) {
        e.preventDefault();
        
        // Get the key element
        var target = e.target;
        while (target && !target.classList.contains('key')) {
            target = target.parentElement;
        }
        
        if (!target) return;
        
        var key = target.getAttribute('data-key');
        if (!key) return;
        
        // Visual feedback
        target.classList.add('active');
        touch.activeKey = target;
        
        // Handle key press
        handleKeyPress(key);
        
        // Show popup for letters/numbers
        if (key.length === 1 || /^[a-z]$/.test(key)) {
            var displayChar = key;
            if ((state.shift || state.caps) && /^[a-z]$/.test(key)) {
                displayChar = key.toUpperCase();
            }
            showPopup(target, displayChar);
        }
        
        // Setup long-press repeat for backspace
        if (key === 'BACKSPACE') {
            touch.holdTimer = setTimeout(function() {
                touch.repeatTimer = setInterval(function() {
                    Bridge.deleteText(1);
                    Bridge.vibrate(2);
                }, CONFIG.REPEAT_INTERVAL);
            }, CONFIG.HOLD_DELAY);
        }
    }
    
    function onPointerUp(e) {
        e.preventDefault();
        
        // Clear active state
        if (touch.activeKey) {
            touch.activeKey.classList.remove('active');
            touch.activeKey = null;
        }
        
        // Clear timers
        clearTimeout(touch.holdTimer);
        clearInterval(touch.repeatTimer);
        touch.holdTimer = null;
        touch.repeatTimer = null;
        
        // Hide popup
        hidePopup();
    }
    
    function bindEvents() {
        var kb = elements.keyboard;
        if (!kb) return;
        
        // Touch events (mobile)
        kb.addEventListener('touchstart', onPointerDown, { passive: false });
        kb.addEventListener('touchend', onPointerUp, { passive: false });
        kb.addEventListener('touchcancel', onPointerUp, { passive: false });
        
        // Mouse events (desktop testing)
        kb.addEventListener('mousedown', onPointerDown, { passive: false });
        kb.addEventListener('mouseup', onPointerUp, { passive: false });
        kb.addEventListener('mouseleave', onPointerUp, { passive: false });
        
        // Prevent context menu
        kb.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });
        
        Bridge.log('Events bound successfully');
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // BRIDGE CALLBACKS - Java à·ƒà·’à¶§ call à¶šà¶»à¶± functions
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    window.onBridgeReady = function() {
        Bridge.log('Android Bridge ready!');
        debug('Bridge Ready âœ“');
    };
    
    window.onInputStart = function(inputType, imeAction) {
        Bridge.log('Input started - type: ' + inputType + ', action: ' + imeAction);
        
        // Number input type = auto switch to numbers
        if (inputType === 2 || inputType === 3) {
            state.mode = 'numbers';
            render();
        }
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INITIALIZATION - à¶†à¶»à¶¸à·Šà¶·à¶º
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function init() {
        try {
            Bridge.log('Initializing keyboard...');
            
            // Cache DOM elements
            elements.keyboard = document.getElementById('keyboard');
            elements.popup = document.getElementById('popup');
            elements.debugEl = document.getElementById('debug');
            
            if (!elements.keyboard) {
                throw new Error('Keyboard container not found!');
            }
            
            // Render keyboard
            render();
            
            // Bind events
            bindEvents();
            
            // Update debug
            debug(Bridge.isAndroid ? 'Android Mode âœ“' : 'Browser Mode (Testing)');
            
            Bridge.log('Keyboard initialized successfully');
            
        } catch (error) {
            console.error('Keyboard init error:', error);
            debug('Error: ' + error.message);
            Bridge.log('Init error: ' + error.message);
        }
    }
    
    // Start when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }

})();
</script>
</body>
</html>