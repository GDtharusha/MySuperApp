<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Jarvis Spy Tool</title>
    <style>
        /* ‡∂¥‡∂ª‡∂´ CSS ‡∂ß‡∑í‡∂ö‡∂∏‡∂∫‡∑í */
        body { background-color: #0d1117; color: #c9d1d9; font-family: 'Courier New', Courier, monospace; display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; }
        h1 { color: #58a6ff; border-bottom: 2px solid #58a6ff; padding-bottom: 10px; }
        .card { background: #161b22; width: 100%; max-width: 400px; padding: 20px; margin: 10px 0; border-radius: 10px; border: 1px solid #30363d; text-align: center; }
        .status-text { font-size: 1.2rem; font-weight: bold; margin: 10px 0; }
        .online { color: #2ea043; }
        .offline { color: #da3633; }
        button { width: 100%; padding: 15px; margin-top: 10px; font-size: 16px; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .btn-cam { background-color: #238636; color: white; }
        .btn-info { background-color: #1f6feb; color: white; }
        .btn-cam:active, .btn-info:active { transform: scale(0.98); opacity: 0.8; }
        #photo-preview { width: 100%; margin-top: 15px; border-radius: 8px; display: none; border: 2px solid #58a6ff; }
    </style>

    <script type="module" src="https://unpkg.com/@ionic/pwa-elements@latest/dist/ionicpwaelements/ionicpwaelements.esm.js"></script>
    <script nomodule src="https://unpkg.com/@ionic/pwa-elements@latest/dist/ionicpwaelements/ionicpwaelements.js"></script>
</head>
<body>

    <h1>üïµÔ∏è‚Äç‚ôÇÔ∏è JARVIS SPY DASHBOARD</h1>

    <div class="card">
        <h3>üì° Network Status</h3>
        <div id="net-status" class="status-text online">Checking...</div>
    </div>

    <div class="card">
        <h3>üì± Device Info</h3>
        <p id="device-info">Waiting for data...</p>
        <button class="btn-info" onclick="getDeviceInfo()">Get Battery & Model</button>
    </div>

    <div class="card">
        <h3>üì∏ Secret Camera</h3>
        <button class="btn-cam" onclick="takePicture()">Take Photo & Save</button>
        <img id="photo-preview" alt="Captured Photo">
    </div>

    <script type="module">
        import { Camera, CameraResultType, CameraSource } from 'https://esm.sh/@capacitor/camera';
        import { Device } from 'https://esm.sh/@capacitor/device';
        import { Network } from 'https://esm.sh/@capacitor/network';
        import { Toast } from 'https://esm.sh/@capacitor/toast';

        // 1. Network
        async function checkNetwork() {
            try {
                const status = await Network.getStatus();
                const el = document.getElementById('net-status');
                if(status.connected) {
                    el.innerText = "ONLINE üü¢";
                    el.className = "status-text online";
                } else {
                    el.innerText = "OFFLINE üî¥";
                    el.className = "status-text offline";
                }
            } catch (e) { console.log("Network check failed in browser"); }
        }
        setInterval(checkNetwork, 3000);
        checkNetwork();

        // 2. Device Info
        window.getDeviceInfo = async function() {
            try {
                const info = await Device.getInfo();
                const battery = await Device.getBatteryInfo();
                document.getElementById('device-info').innerHTML = 
                    `Model: ${info.model || 'PC'} <br> Platform: ${info.platform} <br> Battery: ${(battery.batteryLevel * 100).toFixed(0)}% üîã`;
            } catch (e) {
                document.getElementById('device-info').innerHTML = "PC Mode (Battery info hidden)";
            }
        }

        // 3. Camera (Fixed)
        window.takePicture = async function() {
            try {
                const image = await Camera.getPhoto({
                    quality: 90,
                    allowEditing: false,
                    resultType: CameraResultType.Uri,
                    source: CameraSource.Camera,
                    saveToGallery: true // ‡∑Ü‡∑ù‡∂±‡∑ä ‡∂ë‡∂ö‡∑ö ‡∂±‡∂∏‡∑ä ‡∂ú‡∑ê‡∂Ω‡∂ª‡∑í ‡∂ë‡∂ö‡∂ß ‡∑É‡∑ö‡∑Ä‡∑ä ‡∑Ä‡∑ô‡∂±‡∑ä‡∂± ‡∂Ø‡∑è‡∂±‡∑Ä‡∑è
                });

                const imgEl = document.getElementById('photo-preview');
                imgEl.src = image.webPath;
                imgEl.style.display = 'block';

                await Toast.show({ text: 'Photo Captured!', duration: 'short' });

            } catch (error) {
                console.log("Camera Error: " + error);
                // User ‡∂ö‡∑ê‡∂±‡∑ä‡∑É‡∂Ω‡∑ä ‡∂ö‡∑Ö‡∑ú‡∂≠‡∑ä ‡∂ë‡∂ª‡∂ª‡∑ä ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂ë‡∂± ‡∂ë‡∂ö ‡∑É‡∑è‡∂∏‡∑è‡∂±‡∑ä‚Äç‡∂∫‡∂∫‡∑í
            }
        }
    </script>
</body>
</html>